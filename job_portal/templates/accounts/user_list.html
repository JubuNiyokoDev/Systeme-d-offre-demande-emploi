{% extends 'base.html' %}

{% block title %}Liste des Utilisateurs{% endblock %}

{% block content %}
<h2>Liste des Utilisateurs</h2>
<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Nom d'utilisateur</th>
                <th>Email</th>
                <th>Date d'inscription</th>
                <th>Statut</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.date_joined|date:"d/m/Y" }}</td>
                <td>
                    {% if user.is_banned %}
                        <span class="badge bg-danger">Banni</span>
                    {% else %}
                        <span class="badge bg-success">Actif</span>
                    {% endif %}
                </td>
                <td>
                    {% if request.user.is_authenticated %}
    {% if request.user.is_staff or request.user.is_superuser %}
        {% if user != request.user and not user.is_staff and not user.is_superuser %}
            <form method="post" action="{% url 'accounts:toggle_ban' user.id %}" class="d-inline">
                {% csrf_token %}
                <button type="submit"
                        class="btn btn-sm {% if user.is_banned %}btn-success{% else %}btn-danger{% endif %}"
                        data-bs-toggle="tooltip"
                        title="{% if user.is_banned %}Débloquer cet utilisateur{% else %}Bloquer cet utilisateur{% endif %}">
                    <i class="fas {% if user.is_banned %}fa-unlock{% else %}fa-ban{% endif %}"></i>
                    {% if user.is_banned %}Débannir{% else %}Bannir{% endif %}
                </button>
            </form>
        {% elif user == request.user %}
            <span class="badge bg-primary">Vous-même</span>
        {% else %}
            <span class="badge bg-info">Admin/Staff</span>
        {% endif %}
    {% else %}
        {% if user.is_banned %}
            <span class="badge bg-danger">Banni</span>
        {% else %}
            <span class="badge bg-success">Actif</span>
        {% endif %}
    {% endif %}
{% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })
});
</script>
{% endblock %}
